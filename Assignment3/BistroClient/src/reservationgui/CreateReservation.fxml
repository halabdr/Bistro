<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<StackPane xmlns="http://javafx.com/javafx/17"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="reservationgui.CreateReservationController"
           stylesheets="@/styles/bistro_action.css"
           prefHeight="700" prefWidth="1050">

    <!-- Main Content -->
    <VBox styleClass="action-container">

        <!-- Header Section -->
        <VBox styleClass="action-header-enhanced">
            <Label text="Confirm Reservation" styleClass="action-header-title-large"/>
            <Label text="Review your details, then confirm your booking" styleClass="action-header-subtitle"/>
        </VBox>

        <!-- Scrollable Content Area -->
        <ScrollPane fitToWidth="true"
                    pannable="true"
                    hbarPolicy="NEVER"
                    vbarPolicy="AS_NEEDED"
                    styleClass="page-scroll"
                    VBox.vgrow="ALWAYS">

            <content>
                <VBox fx:id="contentRoot"
                      styleClass="action-content"
                      alignment="TOP_CENTER"
                      spacing="26"
                      fillWidth="true">
                    <padding>
                        <Insets top="26" right="0" bottom="26" left="0"/>
                    </padding>

                    <HBox alignment="CENTER">
                        <VBox styleClass="action-card"
                              spacing="20"
                              maxWidth="680"
                              prefWidth="680">

                            <Label text="Reservation Summary" styleClass="action-section-title"/>

                            <!-- Summary -->
                            <VBox spacing="12"
                                  style="-fx-background-color: #f8fafc;
                                         -fx-background-radius: 12;
                                         -fx-padding: 18;
                                         -fx-border-color: #e2e8f0;
                                         -fx-border-radius: 12;">
                                <HBox spacing="12">
                                    <Label text="Date:" prefWidth="100" style="-fx-text-fill: #64748b; -fx-font-weight: 600;"/>
                                    <Label fx:id="dateValue" text="-" style="-fx-text-fill: #0f172a; -fx-font-weight: 700;"/>
                                </HBox>
                                <HBox spacing="12">
                                    <Label text="Time:" prefWidth="100" style="-fx-text-fill: #64748b; -fx-font-weight: 600;"/>
                                    <Label fx:id="timeValue" text="-" style="-fx-text-fill: #0f172a; -fx-font-weight: 700;"/>
                                </HBox>
                                <HBox spacing="12">
                                    <Label text="Guests:" prefWidth="100" style="-fx-text-fill: #64748b; -fx-font-weight: 600;"/>
                                    <Label fx:id="guestsValue" text="-" style="-fx-text-fill: #0f172a; -fx-font-weight: 700;"/>
                                </HBox>
                                <HBox spacing="12">
                                    <Label text="Customer:" prefWidth="100" style="-fx-text-fill: #64748b; -fx-font-weight: 600;"/>
                                    <Label fx:id="subscriberValue" text="-" style="-fx-text-fill: #0f172a; -fx-font-weight: 700;"/>
                                </HBox>
                            </VBox>

                            <!-- Walk-in Contact Info -->
                            <VBox fx:id="guestInfoBox" spacing="12" visible="false" managed="false">
                                <Separator style="-fx-background-color: #e2e8f0;"/>
                                <Label text="Contact Information" styleClass="action-section-title"/>
                                <Label text="Please provide BOTH phone number and email"
                                       style="-fx-text-fill: #64748b; -fx-font-size: 12px;"/>

                                <!-- Phone -->
                                <VBox spacing="6">
                                    <Label text="Phone Number" styleClass="action-form-label"/>

                                    <HBox spacing="8" alignment="CENTER_LEFT">
                                        <TextField fx:id="phoneField"
                                                   promptText="05X-XXXXXXX"
                                                   HBox.hgrow="ALWAYS"
                                                   style="-fx-background-radius: 10;
                                                          -fx-border-radius: 10;
                                                          -fx-border-color: #cbd5e1;
                                                          -fx-padding: 10;"/>

                                        <!-- ⚠️ icon (hidden by default) -->
                                        <Label fx:id="phoneWarnIcon"
                                               text="⚠"
                                               visible="false" managed="false"
                                               styleClass="warn-icon"/>
                                    </HBox>

                                    <!-- inline error -->
                                    <Label fx:id="phoneErrorLabel"
                                           text=""
                                           visible="false" managed="false"
                                           styleClass="inline-error"/>
                                </VBox>

                                <!-- Email -->
                                <VBox spacing="6">
                                    <Label text="Email Address" styleClass="action-form-label"/>

                                    <HBox spacing="8" alignment="CENTER_LEFT">
                                        <TextField fx:id="emailField"
                                                   promptText="your@email.com"
                                                   HBox.hgrow="ALWAYS"
                                                   style="-fx-background-radius: 10;
                                                          -fx-border-radius: 10;
                                                          -fx-border-color: #cbd5e1;
                                                          -fx-padding: 10;"/>

                                        <!-- ⚠️ icon (hidden by default) -->
                                        <Label fx:id="emailWarnIcon"
                                               text="⚠"
                                               visible="false" managed="false"
                                               styleClass="warn-icon"/>
                                    </HBox>

                                    <!-- inline error -->
                                    <Label fx:id="emailErrorLabel"
                                           text=""
                                           visible="false" managed="false"
                                           styleClass="inline-error"/>
                                </VBox>
                            </VBox>

                            <Separator style="-fx-background-color: #e2e8f0;"/>

                            <!-- Notes -->
                            <Label text="Notes (optional)" styleClass="action-form-label"/>
                            <TextArea fx:id="notesArea"
                                      promptText="Any requests? (e.g., birthday, quiet table...)"
                                      wrapText="true"
                                      prefRowCount="3"
                                      style="-fx-background-radius: 10;
                                             -fx-border-radius: 10;
                                             -fx-border-color: #cbd5e1;"/>

                            <!-- Global status/error -->
                            <Label fx:id="statusLabel"
                                   text=""
                                   styleClass="action-status-error"/>
                        </VBox>
                    </HBox>

                </VBox>
            </content>
        </ScrollPane>

        <!-- Bottom Buttons -->
        <HBox alignment="CENTER" styleClass="action-bottom-bar">
            <HBox spacing="14" alignment="CENTER" maxWidth="560" styleClass="action-bottom-inner">
                <Button text="Back"
                        onAction="#onBack"
                        styleClass="action-secondary-button"
                        prefWidth="180"/>

                <Button fx:id="confirmBtn"
                        text="Confirm Reservation"
                        onAction="#onConfirm"
                        styleClass="action-success-button"
                        prefWidth="240"/>
            </HBox>
        </HBox>

    </VBox>

    <!-- Success Popup Overlay -->
    <StackPane fx:id="successOverlay"
               visible="false" managed="false"
               style="-fx-background-color: rgba(0,0,0,0.55);">

        <VBox alignment="CENTER" spacing="14"
              maxWidth="480"
              style="-fx-background-color: rgba(15, 23, 42, 0.95);
                     -fx-background-radius: 16;
                     -fx-border-radius: 16;
                     -fx-border-color: rgba(255,255,255,0.15);
                     -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.5), 20, 0.2, 0, 8);">
            <padding>
                <Insets top="24" right="28" bottom="24" left="28"/>
            </padding>

            <Label text="✅ Reservation Confirmed"
                   style="-fx-text-fill: white; -fx-font-size: 22px; -fx-font-weight: 800;"/>

            <Label text="Show this code at the entrance terminal"
                   style="-fx-text-fill: rgba(255,255,255,0.75); -fx-font-size: 14px;"/>

            <Label fx:id="confirmationCodeLabel"
                   text="--------"
                   style="-fx-text-fill: white;
                          -fx-font-size: 32px;
                          -fx-font-weight: 900;
                          -fx-font-family: 'Consolas';
                          -fx-background-color: rgba(255,255,255,0.08);
                          -fx-background-radius: 10;
                          -fx-padding: 14 24;
                          -fx-border-color: rgba(255,255,255,0.12);
                          -fx-border-radius: 10;"/>

            <Label fx:id="reservationIdLabel"
                   text="Reservation ID: #"
                   style="-fx-text-fill: rgba(255,255,255,0.6); -fx-font-size: 12px;"/>

            <HBox spacing="12" alignment="CENTER">
                <Button text="Copy Code" onAction="#onCopyCode"
                        style="-fx-background-radius: 8;
                               -fx-font-size: 14px;
                               -fx-font-weight: 600;
                               -fx-padding: 10 20;
                               -fx-background-color: rgba(255,255,255,0.12);
                               -fx-text-fill: white;
                               -fx-cursor: hand;"/>

                <Button text="Done" onAction="#onCloseSuccess"
                        style="-fx-background-radius: 8;
                               -fx-font-size: 14px;
                               -fx-font-weight: 700;
                               -fx-padding: 10 28;
                               -fx-background-color: #22c55e;
                               -fx-text-fill: white;
                               -fx-cursor: hand;"/>
            </HBox>

            <Label fx:id="copiedLabel"
                   text=""
                   style="-fx-text-fill: #4ade80; -fx-font-size: 12px;"/>
        </VBox>
    </StackPane>

</StackPane>
