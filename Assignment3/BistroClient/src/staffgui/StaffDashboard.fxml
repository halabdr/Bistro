<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="staffgui.StaffDashboardController"
            styleClass="dash-root"
            stylesheets="@/styles/bistro_dashboard.css">

    <!-- ================= TOP BAR ================= -->
    <top>
        <HBox styleClass="dash-topbar" alignment="CENTER_LEFT" spacing="14">
            <VBox spacing="2">
                <Label fx:id="welcomeLabel" text="Staff Dashboard" styleClass="dash-title"/>
                <Label text="Manage reservations, waitlist, tables and reports" styleClass="dash-subtitle"/>
            </VBox>

            <Region HBox.hgrow="ALWAYS"/>

            <Button text="Logout" onAction="#onLogout" styleClass="dash-btn-danger"/>
        </HBox>
    </top>

    <!-- ================= CENTER ================= -->
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" 
                    style="-fx-background: transparent; -fx-background-color: transparent;">
        <BorderPane>

            <padding>
                <Insets top="10" right="10" bottom="10" left="10"/>
            </padding>

            <center>
                <TabPane fx:id="tabs" styleClass="dash-tabs">
                    <tabs>

                        <!-- ========= RESERVATIONS ========= -->
                        <Tab text="Reservations" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <HBox spacing="10" styleClass="dash-toolbar" alignment="CENTER_LEFT">
                                        <Button text="Refresh" onAction="#refreshReservations" styleClass="dash-btn"/>
                                    </HBox>
                                </top>
                                <center>
                                    <TableView fx:id="reservationsTable">
                                        <columns>
                                            <TableColumn fx:id="resCodeCol" text="Code" prefWidth="140"/>
                                            <TableColumn fx:id="resDateCol" text="Date" prefWidth="120"/>
                                            <TableColumn fx:id="resTimeCol" text="Time" prefWidth="90"/>
                                            <TableColumn fx:id="resGuestsCol" text="Guests" prefWidth="80"/>
                                            <TableColumn fx:id="resSubCol" text="Subscriber" prefWidth="140"/>
                                        </columns>
                                    </TableView>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= WAITLIST ========= -->
                        <Tab text="Waitlist" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <HBox spacing="10" styleClass="dash-toolbar" alignment="CENTER_LEFT">
                                        <Button text="Refresh" onAction="#refreshWaitlist" styleClass="dash-btn"/>
                                    </HBox>
                                </top>
                                <center>
                                    <TableView fx:id="waitlistTable">
                                        <columns>
                                            <TableColumn fx:id="wlCodeCol" text="Code" prefWidth="140"/>
                                            <TableColumn fx:id="wlGuestsCol" text="Diners" prefWidth="80"/>
                                            <TableColumn fx:id="wlSubCol" text="Subscriber" prefWidth="140"/>
                                        </columns>
                                    </TableView>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= CURRENT DINERS ========= -->
                        <Tab text="Current Diners" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <HBox spacing="10" styleClass="dash-toolbar" alignment="CENTER_LEFT">
                                        <Button text="Refresh" onAction="#refreshCurrentDiners" styleClass="dash-btn"/>
                                    </HBox>
                                </top>
                                <center>
                                    <TableView fx:id="dinersTable">
                                        <columns>
                                            <TableColumn fx:id="dTableCol" text="Table #" prefWidth="70"/>
                                            <TableColumn fx:id="dGuestsCol" text="Guests" prefWidth="60"/>
                                            <TableColumn fx:id="dLocationCol" text="Location" prefWidth="100"/>
                                            <TableColumn fx:id="dCodeCol" text="Code" prefWidth="120"/>
                                            <TableColumn fx:id="dCustomerCol" text="Customer" prefWidth="150"/>
                                            <TableColumn fx:id="dSeatedAtCol" text="Seated At" prefWidth="140"/>
                                        </columns>
                                    </TableView>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= TABLES ========= -->
                        <Tab text="Tables" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <HBox spacing="10" styleClass="dash-toolbar" alignment="CENTER_LEFT">
                                        <Button text="Refresh" onAction="#refreshTables" styleClass="dash-btn"/>
                                        <Button text="Add" onAction="#onAddTable" styleClass="dash-btn-secondary"/>
                                        <Button text="Update" onAction="#onUpdateTable" styleClass="dash-btn-secondary"/>
                                        <Button text="Delete" onAction="#onDeleteTable" styleClass="dash-btn-danger"/>
                                    </HBox>
                                </top>
                                <center>
                                    <TableView fx:id="tablesTable">
                                        <columns>
                                            <TableColumn fx:id="tNumCol" text="Number" prefWidth="90"/>
                                            <TableColumn fx:id="tCapCol" text="Seats" prefWidth="90"/>
                                            <TableColumn fx:id="tLocCol" text="Location" prefWidth="180"/>
                                            <TableColumn fx:id="tStatusCol" text="Status" prefWidth="120"/>
                                        </columns>
                                    </TableView>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= OPENING HOURS ========= -->
                        <Tab text="Opening Hours" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <HBox spacing="10" styleClass="dash-toolbar" alignment="CENTER_LEFT">
                                        <Button text="Refresh" onAction="#refreshOpeningHours" styleClass="dash-btn"/>
                                        <Button text="Update Selected" onAction="#onUpdateOpeningHours"
                                                styleClass="dash-btn-secondary"/>
                                    </HBox>
                                </top>
                                <center>
                                    <TableView fx:id="hoursTable">
                                        <columns>
                                            <TableColumn fx:id="hDayCol" text="Day" prefWidth="150"/>
                                            <TableColumn fx:id="hOpenCol" text="Open" prefWidth="120"/>
                                            <TableColumn fx:id="hCloseCol" text="Close" prefWidth="120"/>
                                        </columns>
                                    </TableView>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= SPECIAL HOURS ========= -->
                        <Tab text="Special Hours" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <HBox spacing="10" styleClass="dash-toolbar" alignment="CENTER_LEFT">
                                        <Button text="Refresh" onAction="#refreshSpecialHours" styleClass="dash-btn"/>
                                        <Button text="Add" onAction="#onAddSpecialHours" styleClass="dash-btn-secondary"/>
                                        <Button text="Delete" onAction="#onDeleteSpecialHours"
                                                styleClass="dash-btn-danger"/>
                                    </HBox>
                                </top>
                                <center>
                                    <TableView fx:id="specialTable">
                                        <columns>
                                            <TableColumn fx:id="sIdCol" text="ID" prefWidth="80"/>
                                            <TableColumn fx:id="sDateCol" text="Date" prefWidth="130"/>
                                            <TableColumn fx:id="sOpenCol" text="Open" prefWidth="120"/>
                                            <TableColumn fx:id="sCloseCol" text="Close" prefWidth="120"/>
                                        </columns>
                                    </TableView>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= REPORTS ========= -->
                        <Tab text="Reports" closable="false">
                            <BorderPane styleClass="dash-card">
                                <top>
                                    <VBox spacing="10" styleClass="dash-toolbar">
                                        <HBox spacing="10" alignment="CENTER_LEFT">
                                            <Label text="Month:"/>
                                            <ComboBox fx:id="reportMonthCombo" prefWidth="170"/>

                                            <Label text="Year:"/>
                                            <TextField fx:id="reportYearField" prefWidth="90" promptText="2026"/>

                                            <Region HBox.hgrow="ALWAYS"/>
                                        </HBox>

                                        <HBox spacing="10" alignment="CENTER_LEFT">
                                            <Button text="Time Report" onAction="#onFetchTimeReport"
                                                    styleClass="dash-btn"/>
                                            <Button text="Subscribers Report"
                                                    onAction="#onFetchSubscribersReport"
                                                    styleClass="dash-btn-secondary"/>
                                        </HBox>
                                    </VBox>
                                </top>

                                <center>
                                    <SplitPane dividerPositions="0.5" orientation="VERTICAL">
                                        <HBox fx:id="chartsArea" spacing="15" alignment="CENTER"
                                              style="-fx-padding: 8;">
                                            <PieChart fx:id="reportPieChart" prefWidth="280" prefHeight="220"
                                                      title="Distribution" legendSide="BOTTOM"/>
                                            <BarChart fx:id="reportBarChart" prefWidth="380" prefHeight="220"
                                                      title="Statistics" legendVisible="false"
                                                      animated="false" categoryGap="10" barGap="3">
                                                <xAxis>
                                                    <CategoryAxis side="BOTTOM" tickLabelRotation="-45" 
                                                                  tickLabelGap="5" animated="false"/>
                                                </xAxis>
                                                <yAxis>
                                                    <NumberAxis side="LEFT" animated="false"/>
                                                </yAxis>
                                            </BarChart>
                                        </HBox>

                                        <TableView fx:id="reportTable">
                                            <columns>
                                                <TableColumn fx:id="repCol1" text="Field" prefWidth="200"/>
                                                <TableColumn fx:id="repCol2" text="Value" prefWidth="350"/>
                                            </columns>
                                        </TableView>
                                    </SplitPane>
                                </center>
                            </BorderPane>
                        </Tab>

                        <!-- ========= REGISTER SUBSCRIBER ========= -->
                        <Tab text="Register Subscriber" closable="false">
                            <BorderPane styleClass="dash-card">
                                <center>
                                    <VBox alignment="CENTER" spacing="20">
                                        <Label text="Register New Subscriber" 
                                               style="-fx-font-size: 22px; -fx-font-weight: 700; -fx-text-fill: #1e3a5f;"/>
                                        <Label text="Enter subscriber details below"
                                               style="-fx-font-size: 13px; -fx-text-fill: #64748b;"/>
                                        
                                        <VBox spacing="16" maxWidth="400" style="-fx-padding: 20 0 0 0;">
                                            <!-- Name -->
                                            <VBox spacing="6">
                                                <Label text="Full Name" style="-fx-font-weight: 600; -fx-text-fill: #334155;"/>
                                                <TextField fx:id="regNameField" promptText="Enter full name" prefWidth="400"/>
                                            </VBox>
                                            
                                            <!-- Email -->
                                            <VBox spacing="6">
                                                <Label text="Email Address" style="-fx-font-weight: 600; -fx-text-fill: #334155;"/>
                                                <TextField fx:id="regEmailField" promptText="Enter email address" prefWidth="400"/>
                                            </VBox>
                                            
                                            <!-- Phone -->
                                            <VBox spacing="6">
                                                <Label text="Phone Number" style="-fx-font-weight: 600; -fx-text-fill: #334155;"/>
                                                <TextField fx:id="regPhoneField" promptText="05X-XXXXXXX" prefWidth="400"/>
                                            </VBox>
                                            
                                            <!-- Password -->
                                            <VBox spacing="6">
                                                <Label text="Password" style="-fx-font-weight: 600; -fx-text-fill: #334155;"/>
                                                <PasswordField fx:id="regPasswordField" promptText="Enter password" prefWidth="400"/>
                                            </VBox>
                                            
                                            <!-- Confirm Password -->
                                            <VBox spacing="6">
                                                <Label text="Confirm Password" style="-fx-font-weight: 600; -fx-text-fill: #334155;"/>
                                                <PasswordField fx:id="regConfirmPasswordField" promptText="Confirm password" prefWidth="400"/>
                                            </VBox>
                                            
                                            <!-- Status Label -->
                                            <Label fx:id="regStatusLabel" text="" 
                                                   style="-fx-text-fill: #E53E3E; -fx-font-size: 13px;"/>
                                            
                                            <!-- Register Button -->
                                            <Button text="Register Subscriber" 
                                                    onAction="#onRegisterSubscriber" 
                                                    styleClass="dash-btn"
                                                    prefWidth="400"
                                                    style="-fx-padding: 12 20;"/>
                                        </VBox>
                                        
                                        <!-- Registration Result Box (hidden by default) -->
                                        <VBox fx:id="registrationResultBox" spacing="12" alignment="CENTER" 
                                              visible="false" managed="false"
                                              style="-fx-background-color: #f0fdf4; -fx-background-radius: 12; -fx-padding: 20; -fx-border-color: #86efac; -fx-border-radius: 12;">
                                            <Label text="âœ“ Registration Successful!" 
                                                   style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-text-fill: #166534;"/>
                                            
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Subscriber Number:" style="-fx-font-weight: 600;"/>
                                                <Label fx:id="resultSubscriberNumber" style="-fx-font-size: 16px; -fx-text-fill: #1e3a5f;"/>
                                            </HBox>
                                            
                                            <HBox spacing="10" alignment="CENTER">
                                                <Label text="Membership Card:" style="-fx-font-weight: 600;"/>
                                                <Label fx:id="resultQRCode" style="-fx-font-size: 14px; -fx-text-fill: #475569;"/>
                                            </HBox>
                                            
                                            <Label fx:id="qrCodeDisplay" 
                                                   style="-fx-font-family: monospace; -fx-font-size: 24px; -fx-background-color: white; -fx-padding: 15; -fx-border-color: #e2e8f0; -fx-border-radius: 8;"/>
                                        </VBox>
                                    </VBox>
                                </center>
                            </BorderPane>
                        </Tab>

                    </tabs>
                </TabPane>
            </center>

        </BorderPane>
        </ScrollPane>
    </center>

    <!-- ================= BOTTOM ================= -->
    <bottom>
        <Label fx:id="statusLabel" text="" styleClass="dash-status"/>
    </bottom>

</BorderPane>